@{
    Layout = "~/_SiteLayout.cshtml";
    Page.Title = "Schedule Builder";  
}

<!DOCTYPE html> 
<html lang="en">
<head>
    <title id='Description'>JavaScript PivotGrid - cell values alignment and number settings</title>

    <style>
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            padding: 3px;
            box-sizing: border-box;
            margin: 0;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {

            $.getJSON("/Services/InsertOutputTest.cshtml/", function(data){

            var source =
                    {
                        localdata: data,
                        datatype: "json",
                        datafields:
                    [
                    { name: 'Game_ID', type: 'string' },
                    { name: 'Date', type: 'string' },
                    { name: 'League_Name', type: 'string' },
                    { name: 'Home_Team', type: 'string' },
                    { name: 'Away_Team', type: 'string' },
                    { name: 'Sheet', type: 'number' }
                    ]
                    };

            var dataAdapter = new $.jqx.dataAdapter(source);
            dataAdapter.dataBind();

            console.log("show the dataAdapter");
            console.log(dataAdapter);

            var getCellValue = function (row, col) {
                var currentDateRecords = [];
                for (i = 0; i < data.length; i++) {
                    if (data[i].Date == row.text && data[i].Sheet == col.parentItem.adapterItem.text) {
                        currentDateRecords.push({ home: data[i].Home_Team, away: data[i].Away_Team });
                    }
                }

                return currentDateRecords;
            };

            // create a pivot data source from the dataAdapter
            var pivotDataSource = new $.jqx.pivot(
                              dataAdapter,
                              {
                                  pivotValuesOnRows: false,
                                  rows: [{
                                      dataField: 'Date', resizable: 'true', height: 30
                                  }],
                                  columns: [{ dataField: 'Sheet', align: 'Center', width: '100%'}],
                                  values: [
                                    { dataField: 'Home_Team', text: 'Home Team', align: 'Center' },
                                    { dataField: 'Away_Team', text: 'Away Team', align: 'Center' }
                                  ]
                              }
                            );
            var isFirst = true;
            $('#myPivotGrid').jqxPivotGrid(
                              {
                                  source: pivotDataSource,
                                  treeStyleRows: true,
                                  multipleSelectionEnabled: true,
                                  scrollBarsEnabled: true,
                                  selectionEnabled: true,
                                  //autoResize: true,
                                  cellsRenderer: function (pivotCell) {
                                      var row = pivotCell.pivotRow;
                                      var col = pivotCell.pivotColumn;

                                      var teams = [];
                                      var cellText = '';
                                      var hasAdditionalText = false;
                                      var size = 25;
                                      if (!!pivotCell.value) {
                                          teams = getCellValue(row, col);
                                          if (col.text == "Away Team") {
                                              cellText = teams[0].away;
                                              cellText.length > 6 ? hasAdditionalText = true : hasAdditionalText = false;
                                              size = Math.round((cellText.length * 2) / 20) * 20;
                                          } else {
                                              cellText = teams[0].home;
                                          }
                                      }

                                      if (isFirst && hasAdditionalText) {
                                          isFirst = false;
                                          setTimeout(function () {
                                              pivotDataSource.rows[0].height = size;
                                              pivotDataSource.dataBind();
                                              $('#myPivotGrid').jqxPivotGrid({ source: pivotDataSource });
                                          }, 500);
                                      }

                                      return "<div style='width: calc(100%-8px); height: 100%; padding: 4px; margin: 0px;'>" + cellText + "</div>";
                                  }
        });
    });
});
    </script>
</head>
<body>
    <p>A bunch of text in front of my pivot</p>
    <div id="myPivotGrid" style="height: 300px; width: 100%; background-color: white;"></div>
</body>
</html>
